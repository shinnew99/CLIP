Clone coding of CLIP but follwing them line by line
